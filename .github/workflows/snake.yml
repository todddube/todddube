name: 🐍 Generate Snake Animation

on:
  schedule:
    # Runs daily at 6:00 UTC for fresh animations
    - cron: "0 6 * * *"
  workflow_dispatch:
    # Manual trigger with custom inputs
    inputs:
      force_update:
        description: 'Force regenerate all animations'
        required: false
        default: 'false'
        type: boolean

# Enhanced permissions for modern GitHub Pages deployment
permissions:
  contents: write
  pages: write
  id-token: write
  actions: read

jobs:
  generate-snake:
    name: 🎨 Generate Contribution Snake
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: 📂 Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for better contribution data

      - name: 🐍 Generate Enhanced Snake Animations
        uses: Platane/snk@v3
        id: snake-animations
        with:
          github_user_name: todddube
          outputs: |
            dist/github-contribution-grid-snake.svg
            dist/github-contribution-grid-snake.gif
            dist/github-contribution-grid-snake-dark.svg?palette=github-dark&color_snake=%23FF6B6B&color_dots=%23FF6B6B,%23FFE66D,%23FF8E53,%23C8E6C9,%234ECDC4
            dist/github-contribution-grid-snake-light.svg?palette=github&color_snake=%2330A3DC&color_dots=%2330A3DC,%23FF6B6B,%23FFE66D,%23FF8E53,%234ECDC4
            dist/github-contribution-grid-snake-ocean.svg?palette=github-dark&color_snake=%2300D4AA&color_dots=%2300D4AA,%23FF6B6B,%23FFE66D,%23FF8E53,%234ECDC4&background=%23161B22&snake_length=8

      - name: 🚀 Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        if: github.ref == 'refs/heads/main'
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          publish_branch: output
          force_orphan: true
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          commit_message: '🐍 Update snake animations - ${{ github.sha }}'

      - name: 📊 Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: snake-animations
          path: dist/
          retention-days: 30

      - name: ✅ Deployment Summary
        run: |
          echo "🎉 Snake animations generated successfully!"
          echo "📊 Generated files:"
          ls -la dist/
          echo "🌐 Animations will be available at: https://raw.githubusercontent.com/todddube/todddube/output/"
